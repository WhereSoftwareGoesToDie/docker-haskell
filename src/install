#!/bin/sh
set +x
set +e

cp /src/.cabal/config /root/.cabal/config

cd /src

apt-get update
cat apt-packages | xargs apt-get install

cabal update
cabal install 'mtl>=2.2'

STACKAGE_URL=$(curl http://www.stackage.org/alias/fpcomplete/unstable-ghc78-inclusive -s -L -I -o /dev/null -w '%{url_effective}')
STACKAGE="remote-repo: stackage-ghc78-inc:${STACKAGE_URL}"

sed -i -Ee 's#^remote-repo: (.*)$#${STACKAGE}#' src/.cabal/config
cabal update

cat cabal-tools | tr "\n" "\0" | xargs -0 cabal install --global
cat cabal-packages | tr "\n" "\0" | xargs -0 cabal install --global
